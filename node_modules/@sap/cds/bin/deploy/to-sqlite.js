exports.deploy = function deploy_to_sqlite (_model, _db, options) {
    const {to:_dbrl} = options
    const cds = require('../../lib/cds')
    const conf = cds.env.requires.db || {}
    const model = _model || conf.model || cds.resolve('*',false)
    const file = _database4 (_db, _dbrl, conf)
    return cds.deploy(model) .to ('sqlite:'+file, options)
    .then (db => db && db.disconnect()) // REVISIT: we should NOT require to disconnect explicitly
}

function _database4  (_db,_dbrl,conf) {
    if (_db)  return _db
    if (_dbrl === 'sqlite')  return 'sqlite.db'
    if (_dbrl === 'sql')  return ':memory:'
    return conf.credentials && conf.credentials.database
}
